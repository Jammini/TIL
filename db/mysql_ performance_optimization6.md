# 6장 스키마 설계와 관리

# 최적의 데이터 유형 선택

MySQL은 다양한 데이터 유형을 지원하며 성능 향상을 위해 데이터를 저장할 올바른 유형을 선택하는 것이 중요하다.

- 작을 수록 좋다.
    - 데이터 유형이 작을수록 디스크, 메모리, CPU 캐시의 공간을 덜 사용하기 때문에 대체로 더 빠르다.
- 단순할수록 좋다.
    - 단순한 데이터 유형에 대한 작업을 처리하는데 더 적은 CPU 주기가 필요하다. ex) 문자 비교가 아닌 정수 비교
- 가급적 NULL을 피한다.
    - 인덱스, 인덱스 통계 및 값 비교를 복잡하게 만들기 떄문에 NULL 가능 열을 참조하는 쿼리는 최적화 하기 어렵다.

### 정수

Signed 유형과 unsigned유형은 동일한 스토리지 공간을 사용하고 동일한 성능을 가지므로 데이터 범위에 적합한 유형을 사용해라.

### 실수

FLOAT 및 DOUBLE 유형은 표준 부동 소수점 연산으로 근사 계산 지원

부동소수점 저장의 부정확성을 방지하고 정확한 결과가 필요한 경우라면 DECIMAL을 사용해야 한다.

### VARCHAR와 CHAR 유형

CAHR 및 VARCHAR 유형은 바이너리 문자열을 저장하는 BINARY 및 VARBINARY 이다. 바이너리 문자열은 기존 문자열과 매우 유사하지만 문자 대신 바이트를 저장한다. 패딩도 다르다.

MySQL은 BINARY 값을 공백 대신 \0(0바이트)으로 채우고 검색시 패드 값을 제거하지 않는다.

### BLOB과 TEXT 유형

대용량 데이터를 각각 바이너리 또는 문자열로 저장하도록 설계된 문자열 데이터 유형

두가지의 차이점은 BLOB 유형은 데이터 정렬이나 문자 집합 없이 바이너리 데이터를 저장하지만, TEXT 유형에는 문자 집합과 데이터 정렬이 있다는 것이다.

데이터 유형의 전체 길이로 인덱싱할 수 없고 정렬에 인덱스를 사용할 수 없다.

### 문자열 유형 대신 ENUM 사용하기

MySQL은 목록에 있는 값의 수에 따라 압축하여 매우 작게 저장한다.

ENUM을 자주 변경되면 운영상 불편을 초래한다.

### Date와 Time 유형

DATETIME과 TIMESTAMP라는 두가지 유사한 데이터 유형을 제공한다.

DATETIME : 8바이트의 저장 공간을 사용해 광범위한 값을 저장할 수 있음. 

TIMESTAMP : 4바이트의 저장 공간을 사용해 1970년 1월 1일 자정 이우 경과된 시간을 저장. 2038년도 문제 발생.

TIMESTAMP는 사용중인 시간대에 상대적인 값을 보존하고, DATETIME은 날짜 및 시간의 텍스트 표현을 보존한다.

### 비트 팩 데이트 유형

데이터 압축 저장을 위해 값 내의 개별 비트를 사용하는 문자열 유형

### JSON 데이터

전반적으로 네이티브 SQL 또는 JSON의 사용 판단은 데이터베이스에 JSON을 저장하는 용이성이 성능보다 우월한지 여부에 달려 있다. 액세스가 많으면 많을 수록 속도 차이가 커진다.

### 식별자 선택

일바적으로 식별자는 행을 참조하는 방법이며 행을 고유하게 만드는 역할을 하는 경우가 많다.

필요한 값 범위를 저장할 수 있는 가장 작은 크기를 선책하고 필요한 경우 향후 확장할 수 있는 공간을 확보해라.

### 정수 타입

빠르고 AUTO_INCREMENT와 함께 작동하므로 일반적으로 식별자에 가장 적합하다.

### ENUM과 SET

상태 또는 유형 값을 포함하는 정적 ‘정의 테이블’에는 적합할 수 있지만 일반적으로 식별자에 적합하지 않다. 주문 상태 또는 제품 유형과 같은 정보를 보유하는데 적합하다.

### 문자열 타입

식별자에 대한 문자열 유형은 공간을 많이 차지하고 일반적으로 정수 유현보다 느리므로 가급적 사용하지 마라.

### 특별한 유형의 데이터

IP주소 같은 경우 문자열이 아니라 부호 없는 32비트 정수이다. IP주소는 부호 없는 정수로 저장해야 한다.

# MySQL의 스키마 설계 문제

MySQL을 사용한 스키마설계에서 발견된 문제에 대해 설명한다.

### 너무 많은 열

매우 넓은 테이블(수백 개의 열)을 사용하는 경우 CPU 소비가 늘어 비용이 많이 든다.

### 너무 많은 조인

MySQL은 조인당 테이블 수가 61개로 제한 되며 문제가 될 수 있다 높은 동시성으로 쿼리를 빠르게 실행하려면 쿼리당 테이블 12개 이하로 사용하는 것이 좋다.

### 지나친 ENUM사용

### NULL의 지나친 배제

알 수 없는 값을 나탄야 할 때 NULL을 사용하는 것을 두려워 하지 말고 써라.

# 스키마 관리

스키마 변경 관리를 ‘데이터 저장 플랫폼’의 한 부분으로 생각하는 방법, 핵심가치, 도구, 제공 수명주기 적합한지 설명한다.

### 성공을 위한 파트너팀 구성

### 지속적인 통합과 스키마 관리 통합

소프트웨어 제공 방식을 염두에 두고 이러한 반복을 가능하게 하는 도구에 대해 논의해라.

### 요약

작고 단순하게 설계해라.

- 복잡한 쿼리나 많은 열이 있는 테이블을 강제하는 스키마처럼 극단적인 설계를 피해라.
- 작고 단순하며 적절한 데이터 유형을 사용해라, 실제 현실의 데이터를 모델링하는 올바른 방법이 아니라면 NULL을 가급적 피해라
- 조인 조건에서 사용할 경우, 동일한 데이터 유형을 사용하여 유사하거나 관련된 값을 저장해라.
- 가능하면 식별자에게 정수를 사용해라
- 부동 소수점 숫자에 대한 정밀도 지정이나 정수에 대한 표시 너비와 같은 기존 MySQL 습관을 경계해라.
- ENUM, SET에 중의해라. 편리하나 남용될 수 있고 떄로는 까다롭다. BIT는 피하는 것이 최선이다.