# 테이블마다 id 칼럼을 PK로 사용한 이유는 무엇일까?

### 목차

1. [개요](#1-개요)
2. [설계 테이블](#2-설계-테이블)
3. [사용한 이유와 장점](#3-사용한-이유와-장점)
    
    3-1. [일관성](#1-일관성)
    
    3-2. [효율성](#2-효율성)
    
    3-3. [확장성](#3-확장성)
    
4. [결론](#4-결론)

## 1. 개요

프로젝트 테이블을 작성하고 리뷰를 받는중 아래와 같은 질문을 받았다.

Q) 각각의 테이블에 auto increment 되는 id 칼럼을 사용한 이유와 했을때의 장점이 무엇인가요?

질문을 받은 나는 대답을 제대로 하지 못하였고 테이블을 왜그렇게 설계했는지보단 관용적으로 이렇게 많이들 사용한다고 해서 자연스럽게 테이블을 설계했던 것이었다.

이번을 계기로 질문에 답을 할 수 있도록 정리를 해보려고 한다.

## 2. 설계 테이블

<img width="572" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/33be85c6-4de1-4130-8562-c16492912828">

내가 설계한 테이블은 위와 같았다. 각각의 테이블에는 id값을 가지고 있는 테이블이다. 여기서 User 테이블을 자세히 살펴보자.

User테이블에는 user_id라는 칼럼이 uniquekey이므로 PK로 사용해도 무방한 것을 볼 수 있다. 그럼에도 불구하고 왜 각 테이블의 id칼럼을 PK로 사용하였을까?

## 3. 사용한 이유와 장점

### 1. 일관성

각각의 테이블마다 PK로 id값을 가지고 있다보니 일관성이 생긴다. 만약 User 테이블에서 user_id가 PK이고 Category 테이블에서 name이 PK였다면 각각의 테이블의 PK를 알아 내기 위해 테이블을 확인하거나 체크가 필요할 것이다.

또한 실제로 데이터를 조회할 때 User가 몇명인지 파악할때 쉽게 파악이 가능하다. 예를 들어 User테이블을 조회했는데 id값이 5000몇의 id값이 나온다면 간단하게 ‘5000명정도의 유저가 있구나’ 라고 쉽게 파악이 가능하다.

### 2. 효율성

MySQL은 PK를 설정하면 해당 값을 Index로 잡아 데이터를 B-tree구조로 저장한다. 또한 MySQL 은 INNO DB storage engine으로 되어 있으며, Index와 Data는 On-Disk 구조위에 존재한다. 디스크 특성상 데이터를 읽어낼 때 블럭 단위로 읽게 된다. 만약 블럭 크리가 1,024kb라면 1kb만 들어있던 1,024kb가 가득 차있던 읽는 사이즈는 1,024kb가 된다.

INNO DB에서 각 데이터를 저장하는 공간은 기본적으로 innodb_paga_size setting을 건들지 않으면 16KB의 크기를 갖는다. 전체 공간을 fully 사용하지 않고 Insert또는 Update상황을 대비해 1/16의 공간(1KB)는 비워둔다. 때문에 한 page에 저장할 수 있는 데이터의 양은 15,000Byte 정도 된다고 볼 수 있다.

<img width="708" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/38dc2207-7057-4d9d-b630-13657f33c3f5">


int type은 항상 4byte의 크기를 갖고, UNSIGNED 속성일 경우 4,294,967,294개의 unique 한 값을 표현 할 수 있다. char type은 1글자당 1byte를 사용하는데 만약 int type과 같은 개수의 unique한 데이터를 알파벳 조합으로 표현하기 위해서는 최소 6byte의 크기가 요구된다. 따라서 1개 page에 저장할 수 있는 index의 개수는 int index table = 15,000/4 = 3,750개, char index table = 15,000/6 = 2,500개가 된다.

즉, 똑같이 3,000개의 데이터를 조회할 때 int를 index로 잡으면 1개의 page만 조회하면 되지만 char를 index로 잡은 테이블은 2개의 page를 조회해야 하는 비효율이 발생한다. index 저장을 위한 storage 공간 역시 같은 데이터를 저장할 때 int를 사용한 테이블이 더 적은 page가 필요하므로 훨씬 효율적이다.

### 3. 확장성

우리의 프로젝트가 정말 잘되어서 데이터가 수백만, 수천만 데이터가 쌓였다고 하자. 그런 경우 나중에 샤딩이나 아니면 파티셔닝 같이 이런 것들을 고민하게 된다.

이때 데이터를 쪼개고 나눈다고 했을 때에도 그 기준을 뭘로 할지에 대한 기준.

즉, 각각의 테이블이 id별로 순차적으로 쌓여있으니 오래된 사용자인지, 최근에 가입한 사용자인지에 대한 판단을 번호로 쉽게 구분을 할 수 있다는 것이다.

## 4. 결론

리뷰로 질문 받았던 내용에 대해 정리하면서 id값을 PK로 사용했을 경우 장점에 대해 전반적으로 정리할 수 있었다.

앞으로도 설계를 하면서도 ‘관용적으로 이렇게 많이 사용하니까’ 보다는 왜 이렇게 사용했는지 이유를 명확히 설명할 수 없다면 정리를 하여 남겨보도록 하자.

### 참고

- [https://devnumgo.tistory.com/entry/primary-key를-int형으로-할-것인가-varchar로-할-것인가](https://devnumgo.tistory.com/entry/primary-key%EB%A5%BC-int%ED%98%95%EC%9C%BC%EB%A1%9C-%ED%95%A0-%EA%B2%83%EC%9D%B8%EA%B0%80-varchar%EB%A1%9C-%ED%95%A0-%EA%B2%83%EC%9D%B8%EA%B0%80)
- https://leo-bb.tistory.com/83
