# 트랜잭션 Isolation level

1. 트랜잭션 동시 실행시 이상 현상
    
    1-1. Dirty read
    
    1-2. Non-repeatable read
    
    1-3. Phantom read
    

## 1. 트랜잭션 동시 실행시 이상현상

트랜잭션들이 동시에 실행될때 발생 가능한 이상 현상들은 다음과 같다.

1. Dirty read
2. Non-repeatable read
3. phantom read

이런 이상한 현상들이 모두 발생하지 않게 만들 수 있지만 그러면 제약사항이 많아져서 동시 처리 가능한 트랜잭션 수가 줄어들어 결국 DB의 전체 처리량이 하락하면서 성능이 안좋아진다.

그러므로, 위와 같이 일부 이상한 현상은 허용하는 몇가지 level을 만들어서 사용자가 필요에 따라서 적절하게 선택할 수 있도록 하는 것이 바로 Isolation level이 된다.

## 1. Dirty read

- commit 되지 않은 변화를 읽었을때 이상한 현상

<img width="703" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/a736cc1e-8d04-4680-85a9-e594314f80e9">

- 트랜잭션1
    - x에 y를 더한다.
- 트랜잭션2
    - y를 70으로 바꾼다.

트랜잭션1이 x에 y를 더하기 위해 x값 10을 읽고 y값을 더하기 전에 트랜잭션2가 y를 70으로 바꿨다.

트랜잭션이 y값 70을 읽고 x값 10과 연산하여 80이라는 값을 x값에 저장하고 트랜잭션 1번은 종료하였다.

하지만, 트랜잭션 2번이 종료되기전 어떠한 이유로 인해 중단되어 롤백이 된다면 y는 기존 값이었던 20으로 되돌아 가버리게 된다.

즉, 트랜잭션1에서 실행되었던 내용은 트랜잭션2가 롤백되면서 유효하지 않은 값으로 실행이 된 이상한 현상을 Dirty read라 한다.

### 2. Non-repeatable read

- 같은 데이터의 값이 달라짐

<img width="700" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/bfde6315-0f77-48dc-8dd3-6699340e993d">

- 트랜잭션1
    - x를 두 번 읽는다
- 트랜잭션2
    - x에 40을 더한다.

트랜잭션1이 먼저 시작했을때, x를 처음 읽었을때 10이라는 값을 읽고 2번째 읽기전에 트랜잭션2가 x를 읽고 40이라는 값을 더하여 저장하였다.

이후, 트랜잭션1이 x의 값을 읽었더니 50이었고 처음 읽었던 값과 달라진 것이다.

즉, 하나의 트랜잭션에서 같은 값을 두 번 읽었는데 데이터의 값이 다르게 나오는 현상을 Non-repeatable read라고 한다.

### 3. Phantom read

- 없던 데이터가 생김

<img width="700" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/0953f81f-02b7-4dcb-8d41-afeb32e60f22">

- 트랜잭션1
    - v가 10인 데이터를 두 번 읽는다.
- 트랜잭션2
    - t2의 v를 10으로 바꾼다.

트랜잭션1이 먼저 시작했을때, v가 10인 튜플을 먼저 읽어온다. 이때 트랜잭션2가 t2의 v를 10으로 바꾸고 커밋한다.

이후, 트랜잭션1이 v가 10인 튜플을 읽었더니 처음 읽었던 결과 값가 다르게 나왔다.

즉, 하나의 트랜잭션에서 같은 값을 두 번 읽었는데 없던 데이터가 생긴 현상을 Phantom read라 한다.
