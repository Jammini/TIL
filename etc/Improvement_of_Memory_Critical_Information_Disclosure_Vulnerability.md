# 메모리 중요정보 노출 취약점 개선방안

### 목차

1. [개요](#1-개요)
2. [취약점 파악](#2-취약점-파악)
3. [개선방안](#3-개선방안)
4. [결론](#4-결론)

## 1. 개요

안드로이드 운영 업무에서 보안점검을 하던 중, 앱에서 중요정보가 메모리에 남는다는 이슈가 발생하였다.

비중요 객체는 가비지 컬렉션(GC) 대상이 되어도 괜찮지만, 중요 정보는 메모리에 남아 있지 않도록 보호하는 것이 중요하다.

어떤 문제점이 있었고 해결은 어떻게 했는지 작성해보려한다.

## 2. 취약점 파악

메모리에 평문으로 저장된 민감한 정보는 보안상 취약하다고 판단한다.

메모리 덤프 도구 중 하나인 Frida를 이용하였고 Fridump를 이용해 Memory Dump를 분석해보았다.

- 설치 가이드가 필요하다면 아래 링크를 통해 살펴보자.
    - https://secuhh.tistory.com/5

### 2-1. Fridump 실행

```
python fridump3.py -U -s -o [덤프저장경로][App패키지명]
```

fridump 루트로 가서 위 명령어를 치면 아래 그림과 같이 메모리 덤프가 실행된다.

<img width="527" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/23ea7873-c3b6-4193-8d11-2686745ac2d0">

### 2-2. 메모리 덤프 결과 확인

결과를 보면 dump폴더가 만들어지며 데이터와 strings.txt파일이 생성 되는 것을 볼 수 있다.

<img width="705" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/d4b2886c-f0de-4242-96d3-ee5713ff426b">

### 2-3. 취약점 확인

strings.txt 파일을 열면 아래와 같이 민감한 개인정보가 남는 취약점을 확인 할 수 있다.

<img width="705" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/27c741aa-2f80-4bb2-a9c9-ea6b132bc5a7">

## 3. 개선방안

이런 개인정보들이 메모리에 남는다면 보안상 많은 문제를 일으킬 수 있다. 해커가 기기를 탈취해서 앱을 실행하고 덤프를 떠 쉽게 탈취가 가능해진다.

내 상황에서는 위에 예시처럼 중요정보를 `String`형태인 불변객체로 데이터를 사용했다. 잘 동작하는 소스를 개선하려고 3가지 방법을 알아보았고 이 중 하나를 통해 개선해보려한다.

1. 중요정보를 암호화하여 저장하는 방법
2. 중요정보를 사용한 후 가변객체를 이용해 빈 값으로 대체하는 방법
3. 솔루션 도입

결론적으로 말하자면 2번을 선택하였다. 이유는 다음과 같다.

- 1번 선택
    - 암호화를 한다는건 복호화도 가능하다는 것이다. 사용된 후 해당 데이터를 계속 사용되지 않는 데이터라면 메모리 내에 계속 남겨두는 것은 불필요하다고 판단했다.
- 3번 선택
    - 운영업무를 하면서, 예상치 못한 비용이 발생하면, 프로젝트 예산관리가 어려워 지며 지속가능성에 영향을 줄 수 있다고 판단한다.
- 2번 선택 → 결정
    - 1번의 문제점과 3번의 문제점을 해결할 수 있는 개선방법이라고 생각했다. 메모리 내에 계속 남겨둘 필요 없이 빈 값으로 대체하여 문제를 해결하고 예상치 못한 비용도 쓰지 않아도 되었다.

## 4. 결론

프로젝트에 처한 상황에 따라 개선방안은 다를 것이다. 하지만 선택에 따른 트레이드 오프를 고려해가며 최적의 선택을 해야 한다.

데이터 보호와 비용 그리고 효율성 사이의 균형을 찾아가며 메모리에 남기지 않도록 안전하고 경제적으로 프로젝트를 관리해야 된다고 생각한다.