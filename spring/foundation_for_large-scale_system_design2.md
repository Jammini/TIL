# 2장 개략적인 규모 추정

개략적 규모 추정을 효과적으로 해 내려면 규모 확장성을 표현하는 데 필요한 기본기에 능숙해야 한다. 특히, 2의 제곱수나 응답지연(latency) 값 그리고 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 한다.

## 2의 제곱수

최소 단위는 1바이트이고, 8비트로 구성된다. ASCII 문자 하나가 차지하는 메모리 크기가 1바이트이다.

<img width="418" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/26867e7a-96ee-4cb5-953b-6ab7baf70e1b">

## 모든 프로그래머가 알아야 하는 응답지연 값

아래 표를 보면 컴퓨터 연산들의 처리 속도가 어느정도인지 짐작할 수 있도록 해준다.

<img width="504" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/70a9d24a-a219-4b17-8552-1267f6604fd4">

2020년 기준으로 시각화한 수치는 다음과 같다.

<img width="558" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/e0f7bda4-6dcb-4fc6-96c0-e05a2eb1f799">

- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색(seek)은 가능한 한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지연(region)에 분산되어 있고 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

## 가용성에 관계된 수치들

고가용성은 시스템이 오랜시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어다. 고가용성을 표현하는 값은 퍼센트로 표현한다. 아래는 0의 개수와 시스템 장애시간(downtime) 사이 관계이다.

<img width="504" alt="image" src="https://github.com/Jammini/TIL/assets/59176149/23e2ad4c-26ce-4a48-b818-8e0249bee9b3">

## 예제: 트위터 QPS와 저장소 요구량 추정

**가정**

- 월간 능동 사용자는 3억 명이다
- 50%의 사용자가 트위터를 매일 사용한다
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다
- 미디어를 포함하는 트윗은 10% 정도다
- 데이터는 5년간 보관된다

**추정**

QPS(Query Per Second) 추정치

- 일간 능동 사용자 = 3억 * 50 % = 1.5억
- QPS = 1.5억 * 2 트윗 / 24시간 / 1분(3600초) = 약 3500
- 최대 QPS = 2 * QPS(3500) = 약 7000

미디어 저장을 위한 저장소 요구량

- 평귱 트윗 크기
    - tweet_id에 64바이트
    - 텍스트에 140바이트
    - 미디어에 1MB
- 미디어 저장소 요구량: 1.5억 * 2 * 10% * 1MB = 30TB / 일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB * 365 * 5 = 약 55PB

## 팁

개략적인 규모 추정과 관계된 면접에서 가장 중요한 것은 문제를 풀어 나가는 절차다.

올바른 절차를 밟느냐가 결과를 내는 것보다 중요하다. 면접자가 보고 싶어하는 것은 문제 해결 능력이다.

- 근사치를 사용한 계산을 할줄 알아야 한다. 즉 반올림, 올림, 내림에 대한 오차 수준을 생각해서 근사치로 계산시간을 절약하자.
- 가정은 적어 둬라. 나중에 살펴볼 수 있도록.
- 단위를 붙이는 습관을 두면 모호함을 방지할 수 있다.
- QPS, 최대 QPS, 저장소 요구링시 요구량 서버 수 등을 추정하는 것이다.